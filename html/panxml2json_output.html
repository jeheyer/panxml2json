<!DOCTYPE html>
<html lang="en">
<head>
  <title>Output Frame</title>
  <meta http-equiv="Cache-Control" content="no-cache"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0" />
  <style>
    table    { width: 100%; border-spacing: 2px; border-collapse: collapse; border: 1px solid black; }
    th,td    { font-family: arial; text-align: left; border: 1px solid black; padding: 4px; }
    tr.even td { background-color: #f8f8f8; }
    tr.odd td { background-color: #dfdfdf; }
  </style>
</head>
<body>

<!-- Load script with handy functions -->
<script src="js/ajax-functions.js"></script>

<div id="results_table"></div>

<script>

(async() => {

    let wsgi_script = "/panxml2json.wsgi";
    const locale = navigator.language;

    if (get_params["command"]) {

        let params = "command=" + get_params["command"];
        if (get_params["device_name"])
            params += "&device_name=" + get_params["device_name"];

        // Populate Drop-down with List of Commands
        MakeAjaxCall(wsgi_script + "?" + params).then(data => {

            console.log(`Ajax call returned ${data.length} rows of data`);

            // Build a list of colums
            let columns = [];
            for (const key in data[0]) {
                if (columns.indexOf(key) === -1) {
                    columns.push(key);
                }
            }

            // Create the table and fill the headers
            let table = document.createElement("table");
            let tr = table.insertRow(-1); 
            for (let i = 0; i < columns.length; i++) {
                let th = document.createElement("th");
                th.innerHTML = columns[i];
                tr.appendChild(th);
            }

            // Fill the rows
            for (let i = 0; i < data.length; i++) {
                tr = table.insertRow(-1);
                for (let j = 0; j < columns.length; j++) {
                    let tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = data[i][columns[j]];
                }
                tr.className = (i % 2  == 0) ? "even" : "odd";
            }

            // Inject the rows to the table
            var divContainer = document.getElementById("results_table");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
        });
    }

})();

</script>
</table>

</body>
</html>
